# SecGo 自动售货机生态系统

[English Version](README.md)

专为小型超市和便利店打造的完整自助结账解决方案。该系统由供店主使用的“管理端 App”、供顾客使用的“自助端 Kiosk App”以及完全离线工作的强大数据同步机制组成。

---

## 🚀 功能特性

### 🏢 管理端 App (店主)
*   **商品管理：** 扫描条形码添加商品。通过 Open Food Facts 或阿里云自定义 API 自动填充商品详情。
*   **库存控制：** 编辑价格、名称和其他商品信息。
*   **支付设置：** 上传您的个人/商业收款二维码（微信支付/支付宝等）。
*   **Kiosk 同步：**
    *   **发现设备：** 扫描 Kiosk 上的二维码即可瞬间配对。
    *   **推送数据：** 一键将您的整个商品数据库推送到 Kiosk。
    *   **拉取数据：** (计划中) 从 Kiosk 获取销售统计和订单历史。
*   **离线优先：** 本地运行。设置完成后，核心功能无需互联网连接。

### 🛒 自助端 Kiosk App (顾客)
*   **自助结账：** 连续条码扫描，提供快速结账体验。
*   **购物车系统：** 实时购物车及总价计算。
*   **支付：** 显示商家的收款二维码供顾客扫描支付。
*   **管理模式：** 隐藏手势（点击二维码 5 次）+ PIN 码保护，用于访问设置或重置交易。
*   **Kiosk 服务器：** 运行嵌入式 HTTP 服务器，用于接收来自管理端 App 的商品更新。
*   **OLED 优化：** 纯黑深色模式，节省电量并防止 OLED 平板烧屏。

### 🌐 通用 API 中间件
*   **灵活后端：** 在设置中切换不同的商品查询 API。
*   **Open Food Facts：** 默认的免费全球食品数据库。
*   **通用 API (阿里云)：** 支持通过阿里云 API 查询中国商品数据（需要 API Key）。
*   **可定制：** 易于扩展的 `ProductMiddleware` 架构，支持 *任何* JSON API。

---

## 🛠 技术栈

*   **语言：** Dart (Flutter)
*   **状态管理：** `setState` (简单且健壮)
*   **本地数据库：** `sqflite` (SQLite)
*   **网络：** `http`, `shelf` (嵌入式服务器)
*   **设备发现：** 基于二维码的配对
*   **环境配置：** `flutter_dotenv` 用于安全存储 API Key

---

## 📦 安装与设置

### 前置要求
*   Flutter SDK (3.0+)
*   Android Studio / VS Code
*   两台设备（一台用于管理端，一台用于 Kiosk）

### 1. 配置环境 (管理端)
在 `Manager/` 目录下创建一个 `.env` 文件：
```bash
ALI_CLOUD_APP_CODE=your_api_key_here
```

### 2. 运行管理端 App
```bash
cd Manager
flutter pub get
flutter run
```

### 3. 运行 Kiosk App
```bash
cd Kiosk
flutter pub get
flutter run
```

---

## 🔗 如何同步 (双重备份系统)

1.  **打开 Kiosk：** 进入 **设置** (主屏幕图标) -> 输入 PIN 码 -> 点击 **启动服务器**。
2.  **打开管理端：** 点击主屏幕上的 **同步 Kiosk**。
3.  **扫描：** 使用管理端 App 扫描 Kiosk 上显示的二维码。
4.  **完成：** 商品数据库即刻传输至 Kiosk。

---

## 📂 项目结构

*   `Manager/`: 供店主使用的移动端 App。
*   `Kiosk/`: 供顾客使用的平板端 App。
*   `Server/`: (可选/旧版) Rust 后端，现已被点对点同步取代。

---

## 📝 许可证

本项目采用 MIT 许可证 - 详情请参阅 [LICENSE](LICENSE) 文件。
